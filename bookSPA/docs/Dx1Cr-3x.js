import{C as W,r as B,D as H,i as z,t as x,v as m,x as e,E as A,F,G as $,H as j,I as D,y as S,J as U,K as Z,_ as X,L as ee,M as te,B as N,N as M,O as oe,o as se,P as E,z as O,Q as le,R as G,A as ne,T as I}from"./DXGQiuwS.js";import{u as P}from"./DZcwX0o9.js";const V=W("/sprites.svg"),re="data:image/svg+xml,%3csvg%20width='55'%20height='41'%20viewBox='0%200%2055%2041'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cg%20clip-path='url(%23clip0_38_1657)'%3e%3cpath%20d='M18.0469%2029.0417V39.2917L22.3438%2035.875L26.6406%2039.2917V33.3542V29.0417H18.0469Z'%20fill='%231F8B48'%20/%3e%3cpath%20d='M1.71875%2015.5458V15.5458C1.71875%2011.0352%201.71875%208.77992%202.50886%207.02081C3.4118%205.01052%205.02094%203.40138%207.03124%202.49844C8.79035%201.70833%2011.0456%201.70833%2015.5562%201.70833H49.2813C51.1669%201.70833%2052.1097%201.70833%2052.6955%202.29411C53.2812%202.8799%2053.2812%203.82271%2053.2812%205.70833V17.3542C53.2812%2019.2398%2053.2812%2020.1826%2052.6955%2020.7684C52.1097%2021.3542%2051.1669%2021.3542%2049.2812%2021.3542H9.40625C5.16056%2021.3542%201.71875%2024.796%201.71875%2029.0417V29.0417C1.71875%2033.2873%205.16056%2036.7292%209.40625%2036.7292H18.0469M26.6406%2036.7292H53.2812'%20stroke='%230F172A'%20stroke-width='2'%20stroke-linecap='round'%20stroke-linejoin='round'%20/%3e%3cpath%20d='M9.45312%2029.0417H53.2812'%20stroke='%230F172A'%20stroke-width='2'%20stroke-linecap='round'%20stroke-linejoin='round'%20/%3e%3cpath%20d='M18.0469%2029.0417V39.2917L22.3438%2035.875L26.6406%2039.2917V29.0417'%20stroke='%230F172A'%20stroke-width='2'%20stroke-linecap='round'%20stroke-linejoin='round'%20/%3e%3c/g%3e%3cdefs%3e%3cclipPath%20id='clip0_38_1657'%3e%3crect%20width='55'%20height='41'%20fill='white'%20/%3e%3c/clipPath%3e%3c/defs%3e%3c/svg%3e",ae=V+"#searchSVG",ie=V+"#closeSVG",ue={class:"relative flex flex-row gap-[25px] py-4 justify-between xl:justify-start"},de=["width","height"],pe={key:0,"xlink:href":ae},ce={key:1,"xlink:href":ie},xe=["placeholder"],ve={class:"flex flex-row gap justify-between items-center"},ge={class:"flex gap-2 text-[20px] font-semibold overflow-hidden"},fe={class:"text-nowrap"},ke={class:"text-[#707786] truncate"},me={class:"flex gap-4"},he={__name:"SearchAndAddComponent",props:{totalBooks:{type:String,required:!0},modelValue:String},emits:["update:modelValue","sortBy"],setup(y,{emit:v}){const f=B(!1),p=P(),{isMobile:h}=H(p),s=B(""),k=B(!0),i=v,g=y,u=z({get:()=>g.modelValue,set:n=>i("update:modelValue",n)});function c(n){s.value==n?k.value=!k.value:k.value=!0,i("sortBy",{option:n,dir:k.value?"ascending":"descending"}),s.value=n}function r(n){h&&(f.value=n.target.value.length!==0)}return(n,o)=>(x(),m(U,null,[e("div",ue,[o[8]||(o[8]=e("img",{class:"min-w-[55px] min-h-[41px]",src:re,alt:"main sign",loading:"lazy"},null,-1)),e("div",{class:A(["relative flex items-center transition-all duration-300 sm:flex-grow",{"w-10 flex-row-reverse":F(h),"w-full":f.value}]),onClick:o[4]||(o[4]=$(t=>F(h)?f.value=!0:null,["stop"]))},[(x(),m("svg",{width:u.value?"24":"20",height:u.value?"24":"20",class:A(["absolute left-[5px] top-[50%] -translate-y-1/2 stroke-[#707786] sm:left-3",{"reset-btn":u.value,"pointer-events-none":!u.value}]),onClick:o[0]||(o[0]=$(t=>i("update:modelValue",""),["stop"]))},[u.value?(x(),m("use",ce)):(x(),m("use",pe))],10,de)),j(e("input",{class:A(["rounded-lg p-[10px] w-[inherit] xs:w-full xs:pl-[40px] sm:pr-[12px]",{"pl-[30px]":f.value}]),type:"text",maxlength:"200",title:"Начните вводить",placeholder:F(h)?"":"Найти ту самую книгу","onUpdate:modelValue":o[1]||(o[1]=t=>u.value=t),onFocusout:o[2]||(o[2]=t=>r(t)),onInput:o[3]||(o[3]=()=>{u.value=u.value.replace(/[^а-яa-z0-9\s\-,.?!:;()]/gi,"")})},null,42,xe),[[D,u.value]])],2)]),e("div",ve,[e("div",ge,[e("span",fe,S(u.value?"Книги по запросу":"Книги в каталоге"),1),e("span",ke,S(u.value?`«${u.value}»`:g.totalBooks),1)]),o[9]||(o[9]=e("div",{id:"desktop"},null,-1))]),e("div",me,[e("button",{onClick:o[5]||(o[5]=t=>c(t.target.dataset.option)),type:"button","data-option":"title",class:"px-2 py-1 rounded-lg bg-slate-100 transition-all duration-300 hover:bg-slate-300"}," Название "),e("button",{onClick:o[6]||(o[6]=t=>c(t.target.dataset.option)),type:"button","data-option":"author",class:"px-2 py-1 rounded-lg bg-slate-100 transition-all duration-300 hover:bg-slate-300"}," Автор "),e("button",{onClick:o[7]||(o[7]=t=>c(t.target.dataset.option)),type:"button","data-option":"year",class:"px-2 py-1 rounded-lg bg-slate-100 transition-all duration-300 hover:bg-slate-300"}," Год ")])],64))}},be={class:"relative h-[inherit] flex justify-center items-center"},ye={__name:"ModalWindowComponent",emits:["isOpen"],setup(y,{emit:v}){const f=v;return(p,h)=>(x(),m("div",{onClick:h[1]||(h[1]=$(s=>f("isOpen",!1),["stop"])),class:"fixed h-full z-[9999] inset-0 bg-[rgba(15,23,42,0.1)] overflow-scroll not-scrollbar cursor-pointer sm:py-10"},[e("div",be,[e("div",{onClick:h[0]||(h[0]=$(()=>{},["stop"])),class:"bg-[rgb(255,255,255)] w-[464px] cursor-auto h-[inherit] sm:h-[555px] sm:rounded-[1rem]"},[Z(p.$slots,"default")])])]))}},we={},Be={class:"w--full h-full z-[1000]"};function _e(y,v){return x(),m("div",Be,v[0]||(v[0]=[e("div",{class:"circle"},null,-1),e("div",{class:"circle"},null,-1),e("div",{class:"circle"},null,-1)]))}const $e=X(we,[["render",_e],["__scopeId","data-v-aaf47278"]]),Fe=V+"#closeSVG",Se=V+"#checkboxSVG",Ce=V+"#checkMark",Ve=V+"#trashBinSVG",Ae={class:"relative p-5 xs:p-7 sm:p-[32px]"},je={class:"text-[#0F172A] text-[20px] font-bold"},De={class:"text-[14px] text-[#8E959F] mb-[16px]"},Oe={class:"flex flex-col gap-2"},Me={for:"title",class:"font-bold text-[#0F172A] text-[14px]"},Ge={for:"author",class:"font-bold text-[#0F172A] text-[14px]"},Ie={for:"year",class:"font-bold text-[#0F172A] text-[14px]"},Ue={for:"genre",class:"font-bold text-[#0F172A] text-[14px] mb-4"},ze={for:"policy",class:"relative flex items-center cursor-pointer"},Le={class:"flex justify-end items-center gap-2"},qe=["disabled"],Ne=["xlink:href"],Ee={class:"text-white text-[14px] transition-all duration-300"},He={__name:"BookForm",props:{editBook:{type:[Object,null],required:!0},title:{type:[String,null],required:!0},p:{type:[String,null],required:!0}},emits:["isOpen","saveBook","updateBook","update:deleteBook"],setup(y,{emit:v}){const f=v,p=y,h=new Date().getFullYear(),s=ee({title:p.editBook?p.editBook.title:"",author:p.editBook?p.editBook.author:"",year:p.editBook?p.editBook.year:"",genre:p.editBook?p.editBook.genre:"",agree:!1}),k=z(()=>Object.values(s).every(o=>o!==!1&&o!=="")),i=()=>{const o=/[^0-9]+/g;s.year=s.year.replace(o,""),s.year.length!==0&&(s.year>h&&(s.year=Number(h)),s.year=Number(s.year))},g=()=>{const o=/[^а-яa-z0-9\s\-,.?!:;()]/gi;s.title=s.title.replace(o,"")},u=()=>{const o=/[^а-яa-z\s-]/gi;s.author=s.author.replace(o,"")},c=()=>{const o=/[^а-яa-z\s-]/gi;s.genre=s.genre.replace(o,"")};function r(){p.editBook?(s.key=p.editBook.key,f("updateBook",s)):f("saveBook",s),f("isOpen",!0)}function n(){f("update:deleteBook",p.editBook),f("isOpen",!0)}return(o,t)=>(x(),m("div",Ae,[e("h1",je,S(p.title),1),e("p",De,S(p.p),1),e("button",{type:"button",onClick:t[0]||(t[0]=$(b=>f("isOpen",!1),["stop"])),class:"reset-btn absolute top-8 right-8 min-w-6 min-h-6"},t[6]||(t[6]=[e("svg",{width:"24",height:"24",class:"stroke-[#707786] transition-all duration-[300ms] hover:stroke-[#000000] hover:scale-110"},[e("use",{"xlink:href":Fe})],-1)])),e("form",{onSubmit:$(r,["prevent"]),class:"flex flex-col gap-4"},[e("div",Oe,[e("label",Me,[t[7]||(t[7]=e("p",{class:"mb-1"},"Название",-1)),j(e("textarea",{name:"title","onUpdate:modelValue":t[1]||(t[1]=b=>s.title=b),id:"title",class:"w-full rounded-lg bg-[#F7F8FA] text-[14px] font-normal px-[12px] py-[10px] not-scrollbar resize-none",type:"text",maxlength:"200",title:"Название произведения",placeholder:"Название произведения",onInput:g},null,544),[[D,s.title]])]),e("label",Ge,[t[8]||(t[8]=e("p",{class:"mb-1"},"Автор",-1)),j(e("input",{"onUpdate:modelValue":t[2]||(t[2]=b=>s.author=b),id:"author",class:"w-full rounded-lg bg-[#F7F8FA] text-[14px] font-normal px-[12px] py-[10px]",type:"text",maxlength:"200",title:"Имя и фамилия автора",placeholder:"Имя и фамилия автора",onInput:u},null,544),[[D,s.author]])]),e("label",Ie,[t[9]||(t[9]=e("p",{class:"mb-1"},"Год",-1)),j(e("input",{"onUpdate:modelValue":t[3]||(t[3]=b=>s.year=b),id:"year",class:"w-full rounded-lg bg-[#F7F8FA] text-[14px] font-normal px-[12px] py-[10px]",type:"text",title:"Год выпуска",placeholder:"Год выпуска",onInput:i},null,544),[[D,s.year]])]),e("label",Ue,[t[10]||(t[10]=e("p",{class:"mb-1"},"Жанр",-1)),j(e("input",{"onUpdate:modelValue":t[4]||(t[4]=b=>s.genre=b),id:"genre",class:"w-full rounded-lg bg-[#F7F8FA] text-[14px] font-normal px-[12px] py-[10px]",type:"text",maxlength:"200",title:"Добавьте жанр произведения",placeholder:"Добавьте жанр произведения",onInput:c},null,544),[[D,s.genre]])])]),e("label",ze,[j(e("input",{id:"policy",type:"checkbox",class:"invisible mr-[20px] peer","onUpdate:modelValue":t[5]||(t[5]=b=>s.agree=b)},null,512),[[te,s.agree]]),t[11]||(t[11]=e("svg",{width:"24",height:"24",class:"absolute left-0 stroke-[#707786] fill-[white] transition-all duration-[300ms] peer-checked:fill-[#1C7D41] peer-checked:stroke-[#1C7D41]"},[e("use",{"xlink:href":Se})],-1)),t[12]||(t[12]=e("svg",{width:"18",height:"18",class:"absolute left-[7px] opacity-0 transition-all duration-[300ms] peer-checked:opacity-100 top-[14px] sm:top-[3px]"},[e("use",{"xlink:href":Ce})],-1)),t[13]||(t[13]=e("span",{class:"text-sm text-[#707786] font-normal text-[9px]"},[N(" Я согласен с условиями "),e("a",{href:"/",class:"relative"},[N(" Политики конфиденциальности "),e("span",{class:"absolute left-0 bottom-0 w-full h-[1px] bg-[#707786]"})])],-1))]),e("div",Le,[e("button",{type:"submit",class:A(["flex flex-row gap-[4px] justify-center items-center transition-all duration-[300ms] rounded-lg py-[10px] px-[12px] w-full sm:w-[max-content] group",{"cursor-not-allowed":!k.value,"ml-auto":!p.editBook,"bg-[#1C7D41] hover:bg-[#19713B]":k.value,"bg-[#D3D3D3]":!k.value}]),disabled:!k.value},[(x(),m("svg",{width:"24",height:"24",class:A(["fill-none stroke-[rgba(255,255,255,0.5)] transition-all duration-[300ms]",{"group-hover:stroke-[rgba(255,255,255,1)]":k.value}])},[e("use",{"xlink:href":p.editBook?"sprites.svg#saveEditedBookSVG":"sprites.svg#addBookSVG"},null,8,Ne)],2)),e("span",Ee,S(p.editBook?"Сохранить":"Добавить"),1)],10,qe),p.editBook?(x(),m("button",{key:0,onClick:$(n,["stop"]),type:"button",class:"flex flex-row gap-[4px] justify-center items-center bg-[#F7F8FA] rounded-lg py-[10px] px-[12px] group w-[max-content]"},t[14]||(t[14]=[e("svg",{width:"24",height:"24",class:"fill-none stroke-[#8E959F] transition-all duration-[300ms] group-hover:stroke-[#900B09]"},[e("use",{"xlink:href":Ve})],-1)]))):M("",!0)])],32)]))}},Pe=oe("db",()=>{const y=B(null),v="books",f=()=>new Promise((i,g)=>{const u=indexedDB.open("UserBooksDB",1);u.onupgradeneeded=c=>{const r=c.target.result;r.objectStoreNames.contains(`${v}`)||r.createObjectStore(`${v}`,{autoIncrement:!0})},u.onsuccess=()=>{y.value=u.result,i()},u.onerror=()=>g(u.error)});async function p(i){const g=Object.assign({},i);return new Promise((u,c)=>{const o=y.value.transaction(`${v}`,"readwrite").objectStore(`${v}`).add(g);o.onsuccess=()=>u(`Книга "${g.title}" добавлена!`),o.onerror=()=>c(o.error)})}async function h(){return new Promise((i,g)=>{const c=y.value.transaction(`${v}`,"readonly").objectStore(`${v}`),r=[],n=c.openCursor();n.onsuccess=o=>{const t=o.target.result;t?(t.value.key=t.key,r.push(t.value),t.continue()):i(r)},n.onerror=()=>g(n.error)})}async function s(i){return new Promise((g,u)=>{const n=y.value.transaction(`${v}`,"readwrite").objectStore(`${v}`).delete(i);n.onsuccess=()=>g(`Книга с ключом ${i} удалена!`),n.onerror=()=>u(n.error)})}async function k(i,g){return new Promise((u,c)=>{const n=y.value.transaction(`${v}`,"readwrite").objectStore(`${v}`),o=n.get(i);o.onsuccess=()=>{const t=o.result;if(t){Object.assign(t,g);const b=n.put(t,i);b.onsuccess=()=>u(`Книга с ключом ${i} обновлена!`),b.onerror=()=>c(b.error)}else c(new Error(`Книга с ключом ${i} не найдена`))},o.onerror=()=>c(o.error)})}return{initDB:f,getAllBooks:h,addBook:p,deleteBook:s,updateBook:k}}),Te=V+"#editBook",Re=V+"#addBookSVG",Ye=V+"#closeSVG",Je={class:"bg-[#F7F8FA] pb-4 px-5 xs:px-7 sm:px-[52px]"},Ke={key:0,class:"flex-grow py-4 px-5 h-min overflow-scroll not-scrollbar xs:px-7 sm:px-[52px]"},Qe={key:0,class:"flex flex-col flex-grow text-[16px] text-[#707786] leading-[120%] px-5 xs:px-7 sm:px-[52px]"},We={key:1,class:"flex flex-col flex-grow gap-4"},Ze={class:"flex justify-between items-start gap-10 mb-2"},Xe={class:"text-[16px] leading-[120%] text-[#0f172a]"},et=["onClick"],tt={class:"flex gap-4 text-[14px] leading-[150%] text-[#707786] truncate"},ot={key:2,class:"flex flex-col flex-grow text-[16px] text-[#707786] leading-[120%] px-5 xs:px-7 sm:px-[52px]"},st={key:1,class:"flex-grow"},lt={width:"24",height:"24",class:"fill-none stroke-white"},nt=["xlink:href"],rt={class:"reset-btn text-white text-[14px]"},ut={__name:"index",setup(y){const v=P(),{isDesktop:f,isTablet:p,isMobile:h}=H(v),s=Pe(),k=B(!1),i=B([]),g=B(null),u=B(!1),c=B(""),r=B([]),n=B({}),o=B(!1);se(async()=>{u.value=!0,setTimeout(async()=>{await s.initDB(),i.value=await s.getAllBooks(),o.value=!0},2e3)});function t(a,l){const w=a.option!=="year"?(_,C)=>_[a.option].localeCompare(C[a.option],["ru","en","en-u-kn-true"],{sensitivity:"base"}):(_,C)=>_[a.option]-C[a.option];l.sort((_,C)=>a.dir==="ascending"?w(_,C):w(C,_))}function b(a){g.value=a,k.value=!0}async function L(a){await s.addBook(a),i.value=await s.getAllBooks(),r.value.length>0&&"deletedBook"in n.value?r.value.push(a):"deletedBook"in n.value&&!r.value&&(r.value=[],r.value.push(a)),n.value={title:"Книга добавлена в список",svg:"sprites.svg#addBookSVG",class:"bg-[#1C7D41] hover:bg-[#19713B] duration-300 transition-all"}}async function T(a){n.value={title:"Книга удалена. Вернуть её",svg:"sprites.svg#trashBinSVG",class:"bg-[#1C7D41] hover:bg-[#19713B] duration-300 transition-all",deletedBook:a},await s.deleteBook(a.key),i.value=await s.getAllBooks(),r.value.length>0&&(r.value=r.value.filter(l=>l.key!==a.key)),r.value.length===0&&c.value.length>0&&(r.value=!1)}async function R(a){await s.updateBook(a.key,a),i.value=await s.getAllBooks(),r.value=r.value.map(l=>i.value.filter(d=>d.key==l.key)).flat()}const Y=z(()=>{const a=new Set(c.value.toLowerCase()),l=[],d=r.value&&r.value.length!==0?r.value:i.value;return d&&d.forEach(w=>{const _=new Set(w.title.toLowerCase());if(w.title.length<c.value.length)return;const C=[...a].filter(Q=>_.has(Q)),K=C.length/_.size*100+c.value.length/w.title.length*100;C.length>0&&l.push({book:w,percentage:K.toFixed(2)})}),l.length===0?!1:(l.sort((w,_)=>_.percentage-w.percentage),l.map(w=>w.book))});function J(){"deletedBook"in n.value?L(n.value.deletedBook):n.value={}}function q(a){a||(n.value={title:"Книга не добавлена",svg:"sprites.svg#bookNotAddedSVG",class:"bg-[#900B09] hover:bg-[#820A08] duration-300 transition-all"}),k.value=a&&!a}return E(k,(a,l)=>{l&&!a&&(g.value=null)}),E(c,(a,l)=>{if(a===""){r.value=[];return}l&&a.length<l.length&&(r.value=[]),r.value=Y.value}),(a,l)=>(x(),m(U,null,[e("div",Je,[O(he,{"total-books":o.value?String(i.value.length):"загружаю, подождите",modelValue:c.value,"onUpdate:modelValue":l[0]||(l[0]=d=>c.value=d),"onUpdate:openAddBookForm":l[1]||(l[1]=d=>k.value=d),onSortBy:l[2]||(l[2]=d=>t(d,r.value?r.value:i.value))},null,8,["total-books","modelValue"])]),o.value?(x(),m("div",Ke,[i.value.length===0&&c.value.length===0?(x(),m("div",Qe," В вашем хранилище нет книг ")):i.value.length>0&&r.value?(x(),m("div",We,[(x(!0),m(U,null,le(r.value.length>0?r.value:i.value,d=>(x(),m("div",{key:d.key,class:"p-4 rounded-2xl border-[#F7F8FA] border-[2px] transition-all duration-[300ms] hover:bg-[#F7F8FA]"},[e("div",Ze,[e("span",Xe,S(d.title),1),e("button",{type:"button",onClick:$(w=>b(d),["stop"]),class:"reset-btn"},l[10]||(l[10]=[e("svg",{width:"20",height:"20",class:"fill-none stroke-[#707786] transition-all duration-[300ms] hover:scale-125"},[e("use",{"xlink:href":Te})],-1)]),8,et)]),e("div",tt,[e("span",null,S(d.author),1),e("span",null,S(d.year),1),e("span",null,S(d.genre),1)])]))),128))])):(x(),m("div",ot," По вашему запросу ничего не найдено "))])):(x(),m("div",st,[O($e)])),k.value?(x(),G(I,{key:2,to:F(f)||F(p)?"body":"#section"},[O(ye,{onIsOpen:l[7]||(l[7]=d=>q(d))},{default:ne(()=>[O(He,{onSaveBook:l[3]||(l[3]=d=>L(d)),onUpdateBook:l[4]||(l[4]=d=>R(d)),onIsOpen:l[5]||(l[5]=d=>q(d)),"onUpdate:deleteBook":l[6]||(l[6]=d=>T(d)),editBook:g.value,title:g.value?"Редактирование":"Добавить книгу",p:g.value?"Внесите изменение в карточке":"Заполните все поля и добавьте книгу в список"},null,8,["editBook","title","p"])]),_:1})],8,["to"])):M("",!0),u.value?(x(),G(I,{key:3,to:F(f)||F(p)?"#desktop":"#mobile"},[e("button",{id:"addBook",onClick:l[8]||(l[8]=$(d=>k.value=!0,["stop"])),class:A(["flex flex-row gap-[4px] justify-center items-center bg-[#1C7D41] rounded-lg py-[10px] px-[12px] w-full transition-all duration-300 group sm:min-w-[max-content] hover:bg-[#19713B]",{"order-2":F(h)}])},l[11]||(l[11]=[e("svg",{width:"24",height:"24",class:"fill-none stroke-[rgba(255,255,255,0.5)] transition-all duration-[300ms] group-hover:stroke-[rgba(255,255,255,1)]"},[e("use",{"xlink:href":Re})],-1),e("span",{class:"text-white text-[14px]"},"Добавить книгу",-1)]),2)],8,["to"])):M("",!0),u.value&&Object.keys(n.value).length>0?(x(),G(I,{key:4,to:F(f)||F(p)?"#section":"#mobile"},[e("button",{onClick:$(J,["stop"]),type:"button",class:A(["reset-btn sticky mx-auto bottom-4 flex flex-row gap-[10px] justify-center items-center rounded-lg py-[10px] px-[12px] w-full sm:w-[max-content]",[n.value.class,{group:!("deletedBook"in n.value)}]])},[(x(),m("svg",lt,[e("use",{"xlink:href":n.value.svg},null,8,nt)])),e("span",rt,S(n.value.title),1),(x(),m("svg",{width:"24",height:"24",class:A(["stroke-[#707786] transition-all duration-[300ms] group-hover:stroke-[rgba(255,255,255,1)]",{"hover:stroke-[rgba(255,255,255,1)]":"deletedBook"in n.value}]),onClick:l[9]||(l[9]=$(d=>n.value={},["stop"]))},l[12]||(l[12]=[e("use",{"xlink:href":Ye},null,-1)]),2))],2)],8,["to"])):M("",!0)],64))}};export{ut as default};
